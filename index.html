<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qur'oniy Zukkolik | Hifz Tizimi</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #059669;
            --primary-dark: #047857;
            --primary-light: #34d399;
            --primary-glow: rgba(5, 150, 105, 0.3);
            --gold: #f59e0b;
            --gold-light: #fbbf24;
            --bg: #f8fafc;
            --bg-secondary: #f1f5f9;
            --surface: #ffffff;
            --text: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --error: #ef4444;
            --error-light: #fef2f2;
            --success: #10b981;
            --success-light: #ecfdf5;
            --radius: 16px;
            --radius-sm: 10px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
            --shadow-glow: 0 0 40px var(--primary-glow);
            --font-main: 'Inter', sans-serif;
            --font-ar: 'Amiri', serif;
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --bg-secondary: #1e293b;
            --surface: #1e293b;
            --text: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border: #334155;
            --error-light: #450a0a;
            --success-light: #064e3b;
            --primary-glow: rgba(52, 211, 153, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-main);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: background 0.4s, color 0.4s;
            overflow-x: hidden;
        }

        /* ===== BACKGROUND PATTERN ===== */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.4;
            background-image: 
                radial-gradient(circle at 20% 50%, var(--primary-glow) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 40%);
        }

        /* ===== CONTAINER ===== */
        .app-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px 16px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-ar);
            font-size: 1.5rem;
            color: white;
            box-shadow: var(--shadow);
        }

        .logo-text {
            font-weight: 800;
            font-size: 1.4rem;
            color: var(--text);
        }

        .logo-text span {
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .lang-select {
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lang-select:hover { border-color: var(--primary); }
        .lang-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-glow); }

        .theme-btn {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-btn:hover { border-color: var(--primary); transform: rotate(15deg); }

        /* ===== PAGES/CARDS ===== */
        .page {
            display: none;
            animation: pageIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .page.active { display: block; }

        @keyframes pageIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 28px 24px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        /* ===== HOME PAGE ===== */
        .welcome-section {
            text-align: center;
            padding: 20px 0;
        }

        .welcome-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            animation: float 3s ease-in-out infinite;
            box-shadow: var(--shadow-glow);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Score Display */
        .score-display {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin: 25px 0;
            text-align: center;
            border: 1px solid var(--border);
        }

        .score-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 3rem;
            font-weight: 900;
            color: var(--gold);
            text-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
        }

        /* ===== BUTTONS ===== */
        .btn {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before { width: 300px; height: 300px; }
        .btn:active { transform: scale(0.98); }
        .btn:focus { outline: none; }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px var(--primary-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--primary-glow);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            color: #78350f;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        /* ===== SETTINGS PAGE ===== */
        .setting-section {
            margin-bottom: 24px;
        }

        .setting-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .option-btn {
            padding: 14px 10px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--text);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .option-btn:hover { border-color: var(--primary-light); }

        .option-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px var(--primary-glow);
        }

        /* Juz Grid */
        .juz-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-height: 280px;
            overflow-y: auto;
            padding: 4px;
        }

        .juz-btn {
            aspect-ratio: 1;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--text);
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .juz-btn:hover { border-color: var(--primary); transform: scale(1.05); }
        .juz-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* Sheikh Selection */
        .sheikh-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .sheikh-card {
            padding: 16px 10px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .sheikh-card:hover { border-color: var(--primary-light); transform: translateY(-2px); }

        .sheikh-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(52, 211, 153, 0.05));
            box-shadow: 0 4px 15px var(--primary-glow);
        }

        .sheikh-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-secondary);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .sheikh-card.selected .sheikh-avatar { background: var(--primary); }

        .sheikh-name {
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--text);
        }

        /* ===== QUIZ PAGE ===== */
        .progress-bar {
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .quiz-counter {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .quiz-mode {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 6px 12px;
            background: var(--bg-secondary);
            border-radius: 20px;
            color: var(--primary);
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.5;
            color: var(--text);
        }

        /* Ayah Display */
        .ayah-display {
            font-family: var(--font-ar);
            font-size: 2rem;
            line-height: 2.2;
            text-align: center;
            color: var(--text);
            padding: 24px 16px;
            margin: 20px 0;
            direction: rtl;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.05), rgba(52, 211, 153, 0.02));
            border-radius: var(--radius);
            border: 1px solid rgba(5, 150, 105, 0.1);
        }

        /* Audio Player */
        .audio-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 30px;
            margin: 20px 0;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .play-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 8px 25px var(--primary-glow);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .play-btn:hover { transform: scale(1.05); }
        .play-btn:active { transform: scale(0.95); }
        .play-btn:disabled { background: var(--text-muted); cursor: not-allowed; box-shadow: none; }

        .play-btn.loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .audio-status {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Options */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-item {
            padding: 18px 20px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            font-weight: 500;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option-item:hover:not(.disabled) {
            border-color: var(--primary-light);
            transform: translateX(4px);
        }

        .option-item.ar-text {
            font-family: var(--font-ar);
            font-size: 1.4rem;
            text-align: right;
            direction: rtl;
            line-height: 1.8;
        }

        .option-letter {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .option-item.correct {
            background: var(--success-light);
            border-color: var(--success);
            animation: correctPulse 0.5s;
        }

        .option-item.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option-item.wrong {
            background: var(--error-light);
            border-color: var(--error);
            animation: shake 0.5s;
        }

        .option-item.wrong .option-letter {
            background: var(--error);
            color: white;
        }

        .option-item.disabled { pointer-events: none; opacity: 0.6; }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Hikmat/Wisdom Box */
        .hikmat-box {
            margin-top: 20px;
            padding: 18px;
            background: linear-gradient(135deg, var(--gold-light), var(--gold));
            border-radius: var(--radius-sm);
            display: none;
            animation: slideUp 0.4s;
        }

        .hikmat-box.show { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hikmat-title {
            font-weight: 700;
            color: #78350f;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .hikmat-text {
            color: #451a03;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .quiz-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .quiz-actions .btn { flex: 1; }

        .btn-next { display: none; }
        .btn-next.show { display: flex; }

        /* ===== RESULT PAGE ===== */
        .result-section {
            text-align: center;
            padding: 20px 0;
        }

        .result-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 900;
            position: relative;
            animation: scaleIn 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .result-circle.excellent {
            background: linear-gradient(135deg, var(--success-light), rgba(16, 185, 129, 0.2));
            color: var(--success);
            border: 4px solid var(--success);
        }

        .result-circle.good {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.2));
            color: var(--gold);
            border: 4px solid var(--gold);
        }

        .result-circle.poor {
            background: linear-gradient(135deg, var(--error-light), rgba(239, 68, 68, 0.2));
            color: var(--error);
            border: 4px solid var(--error);
        }

        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .result-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 24px 0;
        }

        .stat-box {
            padding: 16px;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .stat-box.success {
            background: var(--success-light);
            color: var(--success);
        }

        .stat-box.error {
            background: var(--error-light);
            color: var(--error);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
        }

        .stat-label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 4px;
        }

        .result-message {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* ===== ADVICE PAGE ===== */
        .advice-list {
            list-style: none;
        }

        .advice-item {
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 14px;
            align-items: flex-start;
        }

        .advice-item:last-child { border-bottom: none; }

        .advice-icon {
            width: 36px;
            height: 36px;
            background: var(--bg-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .advice-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text);
        }

        /* ===== DIVIDER ===== */
        .divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* ===== FOOTER ===== */
        .footer {
            margin-top: auto;
            padding: 20px 0;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* ===== UTILITIES ===== */
        .hidden { display: none !important; }
        .mt-20 { margin-top: 20px; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 480px) {
            .juz-grid { grid-template-columns: repeat(5, 1fr); }
            .option-grid { grid-template-columns: repeat(3, 1fr); }
            .sheikh-grid { grid-template-columns: repeat(3, 1fr); }
            .ayah-display { font-size: 1.6rem; padding: 18px 12px; }
            .option-item.ar-text { font-size: 1.2rem; }
        }
    </style>
</head>
<body data-theme="light">
    <div class="bg-pattern"></div>
    
    <div class="app-container">
        <!-- HEADER -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">ï·»</div>
                <div class="logo-text" data-i18n="brand">Qur'on<span>IQ</span></div>
            </div>
            <div class="header-actions">
                <select class="lang-select" id="langSelect" onchange="App.setLanguage(this.value)">
                    <option value="uz">UZ</option>
                    <option value="ar">AR</option>
                    <option value="ru">RU</option>
                    <option value="en">EN</option>
                </select>
                <button class="theme-btn" onclick="App.toggleTheme()" aria-label="Toggle theme">
                    <span id="themeIcon">ğŸŒ™</span>
                </button>
            </div>
        </header>

        <!-- HOME PAGE -->
        <main id="pageHome" class="page active">
            <div class="card">
                <div class="welcome-section">
                    <div class="welcome-icon">ğŸ“–</div>
                    <h1 class="welcome-title" data-i18n="welcomeTitle">Xush Kelibsiz!</h1>
                    <p class="welcome-subtitle" data-i18n="welcomeSubtitle">Qur'on hifzini mustahkamlash va bilimingizni sinash uchun mukammal platforma</p>
                    
                    <div class="score-display">
                        <div class="score-label" data-i18n="highScore">Eng yuqori natija</div>
                        <div class="score-value" id="displayHighScore">0%</div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="App.navigate('settingsText')">
                        <span>ğŸ“</span>
                        <span data-i18n="btnTextTest">Matnli Test</span>
                    </button>
                    <button class="btn btn-gold" onclick="App.navigate('settingsAudio')">
                        <span>ğŸ§</span>
                        <span data-i18n="btnAudioTest">Audio Test</span>
                    </button>
                    <button class="btn btn-secondary" onclick="App.navigate('advice')">
                        <span>ğŸ’¡</span>
                        <span data-i18n="btnAdvice">Maslahatlar</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- TEXT TEST SETTINGS -->
        <section id="pageSettingsText" class="page">
            <div class="card">
                <h2 style="text-align: center; color: var(--primary); margin-bottom: 24px;" data-i18n="textTestSettings">Matnli Test Sozlamalari</h2>

                <div class="setting-section">
                    <div class="setting-label" data-i18n="difficulty">Qiyinchilik darajasi</div>
                    <div class="option-grid">
                        <button class="option-btn" data-diff="easy" onclick="App.setDifficulty('easy')" data-i18n="easy">Oson</button>
                        <button class="option-btn selected" data-diff="medium" onclick="App.setDifficulty('medium')" data-i18n="medium">O'rta</button>
                        <button class="option-btn" data-diff="hard" onclick="App.setDifficulty('hard')" data-i18n="hard">Qiyin</button>
                    </div>
                </div>

                <div class="setting-section">
                    <div class="setting-label" data-i18n="source">Manba tanlovi</div>
                    <button class="btn btn-primary" onclick="App.startTextTest('full')">
                        <span>ğŸ“š</span>
                        <span data-i18n="fullQuran">Butun Qur'on</span>
                    </button>
                    
                    <div class="divider" data-i18n="orSelectJuz">yoki juz tanlang</div>
                    
                    <div class="juz-grid" id="juzGridText"></div>
                </div>

                <button class="btn btn-secondary mt-20" onclick="App.navigate('home')">
                    <span>â†</span>
                    <span data-i18n="back">Ortga</span>
                </button>
            </div>
        </section>

        <!-- AUDIO TEST SETTINGS -->
        <section id="pageSettingsAudio" class="page">
            <div class="card">
                <h2 style="text-align: center; color: var(--primary); margin-bottom: 24px;" data-i18n="audioTestSettings">Audio Test Sozlamalari</h2>

                <div class="setting-section">
                    <div class="setting-label" data-i18n="selectSheikh">Qori tanlang</div>
                    <div class="sheikh-grid" id="sheikhGrid"></div>
                </div>

                <div class="setting-section">
                    <div class="setting-label" data-i18n="testType">Test turi</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="App.startAudioTest('surah')">
                            <span>ğŸ”</span>
                            <span data-i18n="identifySurah">Surani aniqlash</span>
                        </button>
                        <button class="btn btn-gold" onclick="App.startAudioTest('ayah')">
                            <span>â¡ï¸</span>
                            <span data-i18n="continueAyah">Oyat davomini topish</span>
                        </button>
                    </div>
                </div>

                <button class="btn btn-secondary mt-20" onclick="App.navigate('home')">
                    <span>â†</span>
                    <span data-i18n="back">Ortga</span>
                </button>
            </div>
        </section>

        <!-- QUIZ PAGE -->
        <section id="pageQuiz" class="page">
            <div class="card">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>

                <div class="quiz-header">
                    <span class="quiz-counter" id="quizCounter">1 / 10</span>
                    <span class="quiz-mode" id="quizMode">TEST</span>
                </div>

                <p class="question-text" id="questionText">Savol yuklanmoqda...</p>

                <!-- Audio Player (for audio tests) -->
                <div class="audio-player hidden" id="audioPlayer">
                    <button class="play-btn" id="playBtn" onclick="App.playAudio()">
                        <span id="playIcon">â–¶ï¸</span>
                    </button>
                    <span class="audio-status" id="audioStatus" data-i18n="tapToPlay">Tinglash uchun bosing</span>
                </div>

                <!-- Ayah Display (for text tests) -->
                <div class="ayah-display hidden" id="ayahDisplay"></div>

                <!-- Options -->
                <div class="options-container" id="optionsContainer"></div>

                <!-- Wisdom/Hikmat -->
                <div class="hikmat-box" id="hikmatBox">
                    <div class="hikmat-title" data-i18n="hikmatTitle">ğŸ’« Qur'oniy hikmat:</div>
                    <p class="hikmat-text" id="hikmatText"></p>
                </div>

                <div class="quiz-actions">
                    <button class="btn btn-secondary" onclick="App.exitQuiz()" style="flex: 0.7;">
                        <span data-i18n="exit">Chiqish</span>
                    </button>
                    <button class="btn btn-primary btn-next" id="btnNext" onclick="App.nextQuestion()">
                        <span data-i18n="next">Keyingi</span>
                        <span>â†’</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- RESULT PAGE -->
        <section id="pageResult" class="page">
            <div class="card">
                <div class="result-section">
                    <div class="result-circle" id="resultCircle">
                        <span id="resultPercent">0%</span>
                    </div>

                    <div class="result-stats">
                        <div class="stat-box success">
                            <div class="stat-value" id="resultCorrect">0</div>
                            <div class="stat-label" data-i18n="correct">To'g'ri</div>
                        </div>
                        <div class="stat-box error">
                            <div class="stat-value" id="resultWrong">0</div>
                            <div class="stat-label" data-i18n="wrong">Xato</div>
                        </div>
                    </div>

                    <p class="result-message" id="resultMessage">...</p>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="App.navigate('home')">
                            <span>ğŸ </span>
                            <span data-i18n="home">Bosh sahifa</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ADVICE PAGE -->
        <section id="pageAdvice" class="page">
            <div class="card">
                <h2 style="text-align: center; color: var(--primary); margin-bottom: 24px;" data-i18n="adviceTitle">Foydali Maslahatlar</h2>
                
                <ul class="advice-list" id="adviceList"></ul>

                <button class="btn btn-secondary mt-20" onclick="App.navigate('home')">
                    <span>â†</span>
                    <span data-i18n="back">Ortga</span>
                </button>
            </div>
        </section>

        <footer class="footer">
            <p>Â© 2024 Qur'onIQ â€” Hifz mustahkamlash platformasi</p>
        </footer>
    </div>

    <script>
        // ============================================================
        // TRANSLATIONS DATABASE
        // ============================================================
        const I18N = {
            uz: {
                brand: "Qur'onIQ",
                welcomeTitle: "Xush Kelibsiz!",
                welcomeSubtitle: "Qur'on hifzini mustahkamlash va bilimingizni sinash uchun mukammal platforma",
                highScore: "Eng yuqori natija",
                btnTextTest: "Matnli Test",
                btnAudioTest: "Audio Test",
                btnAdvice: "Maslahatlar",
                textTestSettings: "Matnli Test Sozlamalari",
                audioTestSettings: "Audio Test Sozlamalari",
                difficulty: "Qiyinchilik darajasi",
                easy: "Oson",
                medium: "O'rta",
                hard: "Qiyin",
                source: "Manba tanlovi",
                fullQuran: "Butun Qur'on",
                orSelectJuz: "yoki juz tanlang",
                selectSheikh: "Qori tanlang",
                testType: "Test turi",
                identifySurah: "Surani aniqlash",
                continueAyah: "Oyat davomini topish",
                back: "Ortga",
                exit: "Chiqish",
                next: "Keyingi",
                home: "Bosh sahifa",
                tapToPlay: "Tinglash uchun bosing",
                loading: "Yuklanmoqda...",
                hikmatTitle: "ğŸ’« Qur'oniy hikmat:",
                correct: "To'g'ri",
                wrong: "Xato",
                adviceTitle: "Foydali Maslahatlar",
                questionTextTest: "Quyidagi oyatdan keyingi oyatni toping:",
                questionAudioSurah: "Bu qaysi sura?",
                questionAudioAyah: "Eshitgan oyatdan keyin qaysi oyat keladi?",
                modeText: "MATNLI TEST",
                modeAudioSurah: "SURANI TOPING",
                modeAudioAyah: "OYAT DAVOMI",
                resultPerfect: "MashaAlloh! Mukammal natija! Siz haqiqiy Qur'on ahlidasiz.",
                resultGreat: "Juda yaxshi! Biroz takrorlash bilan mukammallikka erishasiz.",
                resultGood: "Yaxshi harakat! Ko'proq mashq qilish kerak.",
                resultFail: "Hali ko'p ish bor. G'ayrat qiling va takrorlang!",
                adviceList: [
                    { icon: "ğŸ¯", text: "Ixlos: Qur'onni faqat Alloh roziligi uchun yodlang." },
                    { icon: "ğŸ“", text: "Mutashabihlar: O'xshash oyatlarni alohida daftarga yozing." },
                    { icon: "ğŸ¢", text: "Tartil: Shoshilmang, sifat miqdordan ustun." },
                    { icon: "ğŸ”„", text: "Takror: Har kungi takror hifzni mustahkam qiladi." },
                    { icon: "ğŸ¤²", text: "Istig'for: Gunohlar unutishga olib keladi, istig'forni ko'paytiring." }
                ]
            },
            ar: {
                brand: "Ø§Ù„Ù‚Ø±Ø¢Ù†IQ",
                welcomeTitle: "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹!",
                welcomeSubtitle: "Ù…Ù†ØµØ© Ù…Ø«Ø§Ù„ÙŠØ© Ù„ØªØ¹Ø²ÙŠØ² Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ø±ÙØªÙƒ",
                highScore: "Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©",
                btnTextTest: "Ø§Ø®ØªØ¨Ø§Ø± Ù†ØµÙŠ",
                btnAudioTest: "Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØªÙŠ",
                btnAdvice: "Ù†ØµØ§Ø¦Ø­",
                textTestSettings: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†ØµÙŠ",
                audioTestSettings: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØªÙŠ",
                difficulty: "Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©",
                easy: "Ø³Ù‡Ù„",
                medium: "Ù…ØªÙˆØ³Ø·",
                hard: "ØµØ¹Ø¨",
                source: "Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØµØ¯Ø±",
                fullQuran: "Ø§Ù„Ù‚Ø±Ø¢Ù† ÙƒØ§Ù…Ù„Ø§Ù‹",
                orSelectJuz: "Ø£Ùˆ Ø§Ø®ØªØ± Ø¬Ø²Ø¡Ø§Ù‹",
                selectSheikh: "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø±Ø¦",
                testType: "Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
                identifySurah: "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³ÙˆØ±Ø©",
                continueAyah: "Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¢ÙŠØ©",
                back: "Ø±Ø¬ÙˆØ¹",
                exit: "Ø®Ø±ÙˆØ¬",
                next: "Ø§Ù„ØªØ§Ù„ÙŠ",
                home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                tapToPlay: "Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹",
                loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",
                hikmatTitle: "ğŸ’« Ø­ÙƒÙ…Ø© Ù‚Ø±Ø¢Ù†ÙŠØ©:",
                correct: "ØµØ­ÙŠØ­",
                wrong: "Ø®Ø·Ø£",
                adviceTitle: "Ù†ØµØ§Ø¦Ø­ Ù…ÙÙŠØ¯Ø©",
                questionTextTest: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©:",
                questionAudioSurah: "Ù…Ø§ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙˆØ±Ø©ØŸ",
                questionAudioAyah: "Ù…Ø§ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ù…Ø§ Ø³Ù…Ø¹ØªØŸ",
                modeText: "Ø§Ø®ØªØ¨Ø§Ø± Ù†ØµÙŠ",
                modeAudioSurah: "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³ÙˆØ±Ø©",
                modeAudioAyah: "Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¢ÙŠØ©",
                resultPerfect: "Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ù†ØªÙŠØ¬Ø© Ù…Ø«Ø§Ù„ÙŠØ©! Ø£Ù†Øª Ù…Ù† Ø£Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø­Ù‚Ø§Ù‹.",
                resultGreat: "Ù…Ù…ØªØ§Ø²! Ù…Ø¹ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³ØªØµÙ„ Ù„Ù„ÙƒÙ…Ø§Ù„.",
                resultGood: "Ø¬Ù‡Ø¯ Ø¬ÙŠØ¯! ØªØ­ØªØ§Ø¬ Ù…Ø²ÙŠØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨.",
                resultFail: "Ù„Ø§ ØªÙŠØ£Ø³! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.",
                adviceList: [
                    { icon: "ğŸ¯", text: "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ: Ø§Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ø¨ØªØºØ§Ø¡ Ù…Ø±Ø¶Ø§Ø© Ø§Ù„Ù„Ù‡ ÙÙ‚Ø·." },
                    { icon: "ğŸ“", text: "Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø§Øª: Ø§ÙƒØªØ¨ Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© ÙÙŠ Ø¯ÙØªØ± Ø®Ø§Øµ." },
                    { icon: "ğŸ¢", text: "Ø§Ù„ØªØ±ØªÙŠÙ„: Ù„Ø§ ØªØ³ØªØ¹Ø¬Ù„ØŒ Ø§Ù„Ø¬ÙˆØ¯Ø© Ø£Ù‡Ù… Ù…Ù† Ø§Ù„ÙƒÙ…ÙŠØ©." },
                    { icon: "ğŸ”„", text: "Ø§Ù„ØªÙƒØ±Ø§Ø±: Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ØªØ«Ø¨Øª Ø§Ù„Ø­ÙØ¸." },
                    { icon: "ğŸ¤²", text: "Ø§Ù„Ø§Ø³ØªØºÙØ§Ø±: Ø§Ù„Ø°Ù†ÙˆØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ù†Ø³ÙŠØ§Ù†ØŒ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø§Ø³ØªØºÙØ§Ø±." }
                ]
            },
            ru: {
                brand: "ĞšĞ¾Ñ€Ğ°Ğ½IQ",
                welcomeTitle: "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ!",
                welcomeSubtitle: "Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ»ĞµĞ½Ğ¸Ñ Ñ…Ğ¸Ñ„Ğ·Ğ° Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹",
                highScore: "Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚",
                btnTextTest: "Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚",
                btnAudioTest: "ĞÑƒĞ´Ğ¸Ğ¾ Ñ‚ĞµÑÑ‚",
                btnAdvice: "Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹",
                textTestSettings: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ°",
                audioTestSettings: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ñ‚ĞµÑÑ‚Ğ°",
                difficulty: "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸",
                easy: "Ğ›ĞµĞ³ĞºĞ¸Ğ¹",
                medium: "Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹",
                hard: "Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹",
                source: "Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°",
                fullQuran: "Ğ’ĞµÑÑŒ ĞšĞ¾Ñ€Ğ°Ğ½",
                orSelectJuz: "Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ¶ÑƒĞ·",
                selectSheikh: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‡Ñ‚ĞµÑ†Ğ°",
                testType: "Ğ¢Ğ¸Ğ¿ Ñ‚ĞµÑÑ‚Ğ°",
                identifySurah: "ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑÑƒÑ€Ñƒ",
                continueAyah: "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ°ÑÑ‚",
                back: "ĞĞ°Ğ·Ğ°Ğ´",
                exit: "Ğ’Ñ‹Ñ…Ğ¾Ğ´",
                next: "Ğ”Ğ°Ğ»ĞµĞµ",
                home: "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ",
                tapToPlay: "ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ",
                loading: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...",
                hikmatTitle: "ğŸ’« ĞšĞ¾Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¾Ğ²ĞµÑ‚:",
                correct: "ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾",
                wrong: "ĞÑˆĞ¸Ğ±ĞºĞ¸",
                adviceTitle: "ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹",
                questionTextTest: "ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ°ÑÑ‚:",
                questionAudioSurah: "ĞšĞ°ĞºĞ°Ñ ÑÑ‚Ğ¾ ÑÑƒÑ€Ğ°?",
                questionAudioAyah: "ĞšĞ°ĞºĞ¾Ğ¹ Ğ°ÑÑ‚ ÑĞ»ĞµĞ´ÑƒĞµÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ»Ñ‹ÑˆĞ°Ğ½Ğ½Ğ¾Ğ³Ğ¾?",
                modeText: "Ğ¢Ğ•ĞšĞ¡Ğ¢ĞĞ’Ğ«Ğ™ Ğ¢Ğ•Ğ¡Ğ¢",
                modeAudioSurah: "ĞĞŸĞ Ğ•Ğ”Ğ•Ğ›Ğ˜Ğ¢Ğ¬ Ğ¡Ğ£Ğ Ğ£",
                modeAudioAyah: "ĞŸĞ ĞĞ”ĞĞ›Ğ–Ğ•ĞĞ˜Ğ• ĞĞ¯Ğ¢Ğ",
                resultPerfect: "ĞœĞ°ÑˆĞ°ĞĞ»Ğ»Ğ°Ñ…! Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚! Ğ’Ñ‹ Ğ¸ÑÑ‚Ğ¸Ğ½Ğ½Ñ‹Ğ¹ Ğ·Ğ½Ğ°Ñ‚Ğ¾Ğº ĞšĞ¾Ñ€Ğ°Ğ½Ğ°.",
                resultGreat: "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ¡ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¾Ğ¹ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ĞµÑ‚Ğµ ÑĞ¾Ğ²ĞµÑ€ÑˆĞµĞ½ÑÑ‚Ğ²Ğ°.",
                resultGood: "Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°! ĞÑƒĞ¶Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¸.",
                resultFail: "ĞĞµ ÑĞ´Ğ°Ğ²Ğ°Ğ¹Ñ‚ĞµÑÑŒ! ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹Ñ‚Ğµ ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒ.",
                adviceList: [
                    { icon: "ğŸ¯", text: "Ğ˜Ñ…Ğ»Ğ°Ñ: Ğ£Ñ‡Ğ¸Ñ‚Ğµ ĞšĞ¾Ñ€Ğ°Ğ½ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ´Ğ¸ Ğ´Ğ¾Ğ²Ğ¾Ğ»ÑŒÑÑ‚Ğ²Ğ° ĞĞ»Ğ»Ğ°Ñ…Ğ°." },
                    { icon: "ğŸ“", text: "ĞœÑƒÑ‚Ğ°ÑˆĞ°Ğ±Ğ¸Ñ…Ğ°Ñ‚: Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ğµ Ğ°ÑÑ‚Ñ‹ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ Ñ‚ĞµÑ‚Ñ€Ğ°Ğ´ÑŒ." },
                    { icon: "ğŸ¢", text: "Ğ¢Ğ°Ñ€Ñ‚Ğ¸Ğ»ÑŒ: ĞĞµ ÑĞ¿ĞµÑˆĞ¸Ñ‚Ğµ, ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ°." },
                    { icon: "ğŸ”„", text: "ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğµ: Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€ ÑƒĞºÑ€ĞµĞ¿Ğ»ÑĞµÑ‚ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ." },
                    { icon: "ğŸ¤²", text: "Ğ˜ÑÑ‚Ğ¸Ğ³Ñ„Ğ°Ñ€: Ğ“Ñ€ĞµÑ…Ğ¸ Ğ²ĞµĞ´ÑƒÑ‚ Ğº Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ, ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ÑŒÑ‚Ğµ Ğ¸ÑÑ‚Ğ¸Ğ³Ñ„Ğ°Ñ€." }
                ]
            },
            en: {
                brand: "QuranIQ",
                welcomeTitle: "Welcome!",
                welcomeSubtitle: "The perfect platform to strengthen your Quran memorization",
                highScore: "High Score",
                btnTextTest: "Text Test",
                btnAudioTest: "Audio Test",
                btnAdvice: "Advice",
                textTestSettings: "Text Test Settings",
                audioTestSettings: "Audio Test Settings",
                difficulty: "Difficulty Level",
                easy: "Easy",
                medium: "Medium",
                hard: "Hard",
                source: "Source Selection",
                fullQuran: "Full Quran",
                orSelectJuz: "or select a juz",
                selectSheikh: "Select Reciter",
                testType: "Test Type",
                identifySurah: "Identify Surah",
                continueAyah: "Continue Ayah",
                back: "Back",
                exit: "Exit",
                next: "Next",
                home: "Home",
                tapToPlay: "Tap to play",
                loading: "Loading...",
                hikmatTitle: "ğŸ’« Quranic wisdom:",
                correct: "Correct",
                wrong: "Wrong",
                adviceTitle: "Helpful Advice",
                questionTextTest: "Find the next ayah:",
                questionAudioSurah: "Which surah is this?",
                questionAudioAyah: "What ayah comes after what you heard?",
                modeText: "TEXT TEST",
                modeAudioSurah: "IDENTIFY SURAH",
                modeAudioAyah: "CONTINUE AYAH",
                resultPerfect: "MashaAllah! Perfect result! You are truly among the people of Quran.",
                resultGreat: "Excellent! With practice, you'll reach perfection.",
                resultGood: "Good effort! More practice needed.",
                resultFail: "Don't give up! Keep learning and reviewing.",
                adviceList: [
                    { icon: "ğŸ¯", text: "Ikhlas: Memorize Quran solely for Allah's pleasure." },
                    { icon: "ğŸ“", text: "Mutashabihat: Write similar verses in a separate notebook." },
                    { icon: "ğŸ¢", text: "Tartil: Don't rush, quality over quantity." },
                    { icon: "ğŸ”„", text: "Review: Daily revision strengthens memory." },
                    { icon: "ğŸ¤²", text: "Istighfar: Sins cause forgetfulness, increase istighfar." }
                ]
            }
        };

        // ============================================================
        // SHEIKH DATA (for audio tests)
        // ============================================================
        const SHEIKHS = [
            { id: 'alafasy', name: 'Al-Afasy', apiId: 'ar.alafasy', emoji: 'ğŸ™ï¸' },
            { id: 'husary', name: 'Al-Husary', apiId: 'ar.husary', emoji: 'ğŸ“¿' },
            { id: 'minshawi', name: 'Al-Minshawi', apiId: 'ar.minshawi', emoji: 'ğŸŒ™' }
        ];

        // ============================================================
        // QURAN DATA - JUZ 30 SURAHS (for demo/quiz)
        // ============================================================
        const SURAHS_JUZ30 = [
            { number: 78, name: 'An-Naba', ar: 'Ø§Ù„Ù†Ø¨Ø£', ayahs: 40 },
            { number: 79, name: 'An-Naziat', ar: 'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª', ayahs: 46 },
            { number: 80, name: 'Abasa', ar: 'Ø¹Ø¨Ø³', ayahs: 42 },
            { number: 81, name: 'At-Takwir', ar: 'Ø§Ù„ØªÙƒÙˆÙŠØ±', ayahs: 29 },
            { number: 82, name: 'Al-Infitar', ar: 'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±', ayahs: 19 },
            { number: 83, name: 'Al-Mutaffifin', ar: 'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†', ayahs: 36 },
            { number: 84, name: 'Al-Inshiqaq', ar: 'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚', ayahs: 25 },
            { number: 85, name: 'Al-Buruj', ar: 'Ø§Ù„Ø¨Ø±ÙˆØ¬', ayahs: 22 },
            { number: 86, name: 'At-Tariq', ar: 'Ø§Ù„Ø·Ø§Ø±Ù‚', ayahs: 17 },
            { number: 87, name: 'Al-Ala', ar: 'Ø§Ù„Ø£Ø¹Ù„Ù‰', ayahs: 19 },
            { number: 88, name: 'Al-Ghashiyah', ar: 'Ø§Ù„ØºØ§Ø´ÙŠØ©', ayahs: 26 },
            { number: 89, name: 'Al-Fajr', ar: 'Ø§Ù„ÙØ¬Ø±', ayahs: 30 },
            { number: 90, name: 'Al-Balad', ar: 'Ø§Ù„Ø¨Ù„Ø¯', ayahs: 20 },
            { number: 91, name: 'Ash-Shams', ar: 'Ø§Ù„Ø´Ù…Ø³', ayahs: 15 },
            { number: 92, name: 'Al-Layl', ar: 'Ø§Ù„Ù„ÙŠÙ„', ayahs: 21 },
            { number: 93, name: 'Ad-Duha', ar: 'Ø§Ù„Ø¶Ø­Ù‰', ayahs: 11 },
            { number: 94, name: 'Ash-Sharh', ar: 'Ø§Ù„Ø´Ø±Ø­', ayahs: 8 },
            { number: 95, name: 'At-Tin', ar: 'Ø§Ù„ØªÙŠÙ†', ayahs: 8 },
            { number: 96, name: 'Al-Alaq', ar: 'Ø§Ù„Ø¹Ù„Ù‚', ayahs: 19 },
            { number: 97, name: 'Al-Qadr', ar: 'Ø§Ù„Ù‚Ø¯Ø±', ayahs: 5 },
            { number: 98, name: 'Al-Bayyinah', ar: 'Ø§Ù„Ø¨ÙŠÙ†Ø©', ayahs: 8 },
            { number: 99, name: 'Az-Zalzalah', ar: 'Ø§Ù„Ø²Ù„Ø²Ù„Ø©', ayahs: 8 },
            { number: 100, name: 'Al-Adiyat', ar: 'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª', ayahs: 11 },
            { number: 101, name: 'Al-Qariah', ar: 'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©', ayahs: 11 },
            { number: 102, name: 'At-Takathur', ar: 'Ø§Ù„ØªÙƒØ§Ø«Ø±', ayahs: 8 },
            { number: 103, name: 'Al-Asr', ar: 'Ø§Ù„Ø¹ØµØ±', ayahs: 3 },
            { number: 104, name: 'Al-Humazah', ar: 'Ø§Ù„Ù‡Ù…Ø²Ø©', ayahs: 9 },
            { number: 105, name: 'Al-Fil', ar: 'Ø§Ù„ÙÙŠÙ„', ayahs: 5 },
            { number: 106, name: 'Quraysh', ar: 'Ù‚Ø±ÙŠØ´', ayahs: 4 },
            { number: 107, name: 'Al-Maun', ar: 'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†', ayahs: 7 },
            { number: 108, name: 'Al-Kawthar', ar: 'Ø§Ù„ÙƒÙˆØ«Ø±', ayahs: 3 },
            { number: 109, name: 'Al-Kafirun', ar: 'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†', ayahs: 6 },
            { number: 110, name: 'An-Nasr', ar: 'Ø§Ù„Ù†ØµØ±', ayahs: 3 },
            { number: 111, name: 'Al-Masad', ar: 'Ø§Ù„Ù…Ø³Ø¯', ayahs: 5 },
            { number: 112, name: 'Al-Ikhlas', ar: 'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ', ayahs: 4 },
            { number: 113, name: 'Al-Falaq', ar: 'Ø§Ù„ÙÙ„Ù‚', ayahs: 5 },
            { number: 114, name: 'An-Nas', ar: 'Ø§Ù„Ù†Ø§Ø³', ayahs: 6 }
        ];

        // ============================================================
        // HIKMAT (Wisdom quotes)
        // ============================================================
        const HIKMATLAR = {
            uz: [
                "Qur'on ahli - Allohning xos bandalari.",
                "Har kuni bir sahifa - bir yilda Qur'on.",
                "Sabr va takror - hifzning kaliti.",
                "Qalbingizni Qur'on bilan yoritib boring.",
                "Alloh sabrlilar bilan birga."
            ],
            ar: [
                "Ø£Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ù‡Ù… Ø£Ù‡Ù„ Ø§Ù„Ù„Ù‡ ÙˆØ®Ø§ØµØªÙ‡.",
                "ØµÙØ­Ø© ÙƒÙ„ ÙŠÙˆÙ… - Ø§Ù„Ù‚Ø±Ø¢Ù† ÙƒØ§Ù…Ù„Ø§Ù‹ ÙÙŠ Ø³Ù†Ø©.",
                "Ø§Ù„ØµØ¨Ø± ÙˆØ§Ù„ØªÙƒØ±Ø§Ø± Ù…ÙØªØ§Ø­ Ø§Ù„Ø­ÙØ¸.",
                "Ø£Ù†Ø± Ù‚Ù„Ø¨Ùƒ Ø¨Ø§Ù„Ù‚Ø±Ø¢Ù†.",
                "Ø¥Ù† Ø§Ù„Ù„Ù‡ Ù…Ø¹ Ø§Ù„ØµØ§Ø¨Ø±ÙŠÙ†."
            ],
            ru: [
                "Ğ›ÑĞ´Ğ¸ ĞšĞ¾Ñ€Ğ°Ğ½Ğ° â€” Ğ¾ÑĞ¾Ğ±Ñ‹Ğµ Ñ€Ğ°Ğ±Ñ‹ ĞĞ»Ğ»Ğ°Ñ…Ğ°.",
                "Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ² Ğ´ĞµĞ½ÑŒ â€” ĞšĞ¾Ñ€Ğ°Ğ½ Ğ·Ğ° Ğ³Ğ¾Ğ´.",
                "Ğ¢ĞµÑ€Ğ¿ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğµ â€” ĞºĞ»ÑÑ‡ Ğº Ñ…Ğ¸Ñ„Ğ·Ñƒ.",
                "ĞÑĞ²ĞµÑ‰Ğ°Ğ¹Ñ‚Ğµ ÑĞµÑ€Ğ´Ñ†Ğµ ĞšĞ¾Ñ€Ğ°Ğ½Ğ¾Ğ¼.",
                "ĞĞ»Ğ»Ğ°Ñ… Ñ Ñ‚ĞµÑ€Ğ¿ĞµĞ»Ğ¸Ğ²Ñ‹Ğ¼Ğ¸."
            ],
            en: [
                "People of Quran are the special servants of Allah.",
                "A page a day â€” Quran in a year.",
                "Patience and repetition â€” key to hifz.",
                "Illuminate your heart with Quran.",
                "Allah is with the patient."
            ]
        };

        // ============================================================
        // MAIN APP CONTROLLER
        // ============================================================
        const App = {
            // State
            state: {
                language: 'uz',
                theme: 'light',
                difficulty: 'medium',
                selectedSheikh: SHEIKHS[0],
                selectedJuz: null,
                testMode: null, // 'text', 'audio_surah', 'audio_ayah'
                questions: [],
                currentIndex: 0,
                score: 0,
                totalQuestions: 10,
                isAnswered: false,
                highScore: 0,
                currentAudio: null,
                ayahCache: {}
            },

            // Initialize
            init() {
                // Load saved data
                this.state.language = localStorage.getItem('quraniq_lang') || 'uz';
                this.state.theme = localStorage.getItem('quraniq_theme') || 'light';
                this.state.highScore = parseInt(localStorage.getItem('quraniq_highscore') || '0');

                // Apply
                document.body.setAttribute('data-theme', this.state.theme);
                document.getElementById('langSelect').value = this.state.language;
                document.getElementById('themeIcon').textContent = this.state.theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
                document.getElementById('displayHighScore').textContent = this.state.highScore + '%';

                // Render UI
                this.applyTranslations();
                this.renderJuzGrid();
                this.renderSheikhGrid();
                this.renderAdviceList();
            },

            // ============ NAVIGATION ============
            navigate(page) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                const pageMap = {
                    'home': 'pageHome',
                    'settingsText': 'pageSettingsText',
                    'settingsAudio': 'pageSettingsAudio',
                    'quiz': 'pageQuiz',
                    'result': 'pageResult',
                    'advice': 'pageAdvice'
                };
                document.getElementById(pageMap[page]).classList.add('active');
                window.scrollTo(0, 0);
            },

            // ============ LANGUAGE ============
            setLanguage(lang) {
                this.state.language = lang;
                localStorage.setItem('quraniq_lang', lang);
                document.documentElement.lang = lang;
                if (lang === 'ar') {
                    document.body.style.direction = 'rtl';
                } else {
                    document.body.style.direction = 'ltr';
                }
                this.applyTranslations();
                this.renderAdviceList();
            },

            applyTranslations() {
                const t = I18N[this.state.language];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (t[key]) {
                        el.textContent = t[key];
                    }
                });
            },

            t(key) {
                return I18N[this.state.language][key] || key;
            },

            // ============ THEME ============
            toggleTheme() {
                this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
                document.body.setAttribute('data-theme', this.state.theme);
                document.getElementById('themeIcon').textContent = this.state.theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('quraniq_theme', this.state.theme);
            },

            // ============ SETTINGS ============
            setDifficulty(diff) {
                this.state.difficulty = diff;
                document.querySelectorAll('[data-diff]').forEach(btn => {
                    btn.classList.toggle('selected', btn.getAttribute('data-diff') === diff);
                });
            },

            selectSheikh(sheikhId) {
                this.state.selectedSheikh = SHEIKHS.find(s => s.id === sheikhId);
                document.querySelectorAll('.sheikh-card').forEach(card => {
                    card.classList.toggle('selected', card.getAttribute('data-sheikh') === sheikhId);
                });
            },

            selectJuz(juz) {
                this.state.selectedJuz = juz;
                document.querySelectorAll('.juz-btn').forEach(btn => {
                    btn.classList.toggle('selected', parseInt(btn.getAttribute('data-juz')) === juz);
                });
                // Start test immediately when juz is selected
                setTimeout(() => this.startTextTest('juz'), 200);
            },

            // ============ RENDER FUNCTIONS ============
            renderJuzGrid() {
                const container = document.getElementById('juzGridText');
                container.innerHTML = '';
                for (let i = 1; i <= 30; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'juz-btn';
                    btn.setAttribute('data-juz', i);
                    btn.textContent = i;
                    btn.onclick = () => this.selectJuz(i);
                    container.appendChild(btn);
                }
            },

            renderSheikhGrid() {
                const container = document.getElementById('sheikhGrid');
                container.innerHTML = '';
                SHEIKHS.forEach((sheikh, index) => {
                    const card = document.createElement('div');
                    card.className = `sheikh-card ${index === 0 ? 'selected' : ''}`;
                    card.setAttribute('data-sheikh', sheikh.id);
                    card.innerHTML = `
                        <div class="sheikh-avatar">${sheikh.emoji}</div>
                        <div class="sheikh-name">${sheikh.name}</div>
                    `;
                    card.onclick = () => this.selectSheikh(sheikh.id);
                    container.appendChild(card);
                });
            },

            renderAdviceList() {
                const list = document.getElementById('adviceList');
                const advices = I18N[this.state.language].adviceList;
                list.innerHTML = advices.map(a => `
                    <li class="advice-item">
                        <div class="advice-icon">${a.icon}</div>
                        <p class="advice-text">${a.text}</p>
                    </li>
                `).join('');
            },

            // ============ API FUNCTIONS ============
            async fetchAyah(surahNum, ayahNum) {
                const cacheKey = `${surahNum}:${ayahNum}`;
                if (this.state.ayahCache[cacheKey]) {
                    return this.state.ayahCache[cacheKey];
                }
                
                try {
                    const response = await fetch(`https://api.alquran.cloud/v1/ayah/${surahNum}:${ayahNum}`);
                    const data = await response.json();
                    if (data.code === 200) {
                        this.state.ayahCache[cacheKey] = data.data;
                        return data.data;
                    }
                } catch (error) {
                    console.error('API Error:', error);
                }
                return null;
            },

            async fetchSurah(surahNum) {
                try {
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNum}`);
                    const data = await response.json();
                    if (data.code === 200) {
                        return data.data;
                    }
                } catch (error) {
                    console.error('API Error:', error);
                }
                return null;
            },

            getAudioUrl(surahNum, ayahNum) {
                // Calculate global ayah number
                const sheikhApi = this.state.selectedSheikh.apiId;
                return `https://cdn.islamic.network/quran/audio/128/${sheikhApi}/${surahNum}:${ayahNum}.mp3`;
            },

            getAudioUrlByGlobal(globalAyahNum) {
                const sheikhApi = this.state.selectedSheikh.apiId;
                return `https://cdn.islamic.network/quran/audio/128/${sheikhApi}/${globalAyahNum}.mp3`;
            },

            // ============ GENERATE QUESTIONS ============
            async generateTextQuestions(source) {
                const questions = [];
                const numQuestions = this.state.totalQuestions;
                
                // Select surahs based on difficulty and source
                let targetSurahs = [...SURAHS_JUZ30];
                if (source === 'juz' && this.state.selectedJuz === 30) {
                    // Already using juz 30
                }
                
                // Shuffle surahs
                targetSurahs = this.shuffleArray(targetSurahs);

                for (let i = 0; i < numQuestions && i < targetSurahs.length; i++) {
                    const surah = targetSurahs[i];
                    const maxAyah = Math.max(1, surah.ayahs - 1);
                    const ayahNum = Math.floor(Math.random() * maxAyah) + 1;
                    
                    try {
                        const currentAyah = await this.fetchAyah(surah.number, ayahNum);
                        const nextAyah = await this.fetchAyah(surah.number, ayahNum + 1);
                        
                        if (currentAyah && nextAyah) {
                            // Generate wrong options from other ayahs
                            const wrongOptions = [];
                            for (let j = 0; j < 3; j++) {
                                const wrongSurah = targetSurahs[(i + j + 1) % targetSurahs.length];
                                const wrongAyahNum = Math.floor(Math.random() * wrongSurah.ayahs) + 1;
                                const wrongAyahData = await this.fetchAyah(wrongSurah.number, wrongAyahNum);
                                if (wrongAyahData) {
                                    wrongOptions.push(wrongAyahData.text);
                                }
                            }

                            if (wrongOptions.length >= 3) {
                                const options = this.shuffleArray([nextAyah.text, ...wrongOptions.slice(0, 3)]);
                                questions.push({
                                    type: 'text',
                                    surah: surah.name,
                                    surahAr: surah.ar,
                                    ayahText: currentAyah.text,
                                    correctAnswer: nextAyah.text,
                                    options: options,
                                    correctIndex: options.indexOf(nextAyah.text)
                                });
                            }
                        }
                    } catch (error) {
                        console.error('Error generating question:', error);
                    }
                }

                return questions;
            },

            async generateAudioSurahQuestions() {
                const questions = [];
                const targetSurahs = this.shuffleArray([...SURAHS_JUZ30]).slice(0, this.state.totalQuestions);

                for (const surah of targetSurahs) {
                    const ayahNum = 1; // First ayah
                    const ayahData = await this.fetchAyah(surah.number, ayahNum);
                    
                    if (ayahData) {
                        // Generate wrong options (other surah names)
                        const otherSurahs = SURAHS_JUZ30.filter(s => s.number !== surah.number);
                        const wrongSurahs = this.shuffleArray(otherSurahs).slice(0, 3);
                        
                        const options = this.shuffleArray([
                            { name: surah.name, ar: surah.ar },
                            ...wrongSurahs.map(s => ({ name: s.name, ar: s.ar }))
                        ]);

                        questions.push({
                            type: 'audio_surah',
                            surah: surah,
                            ayahNumber: ayahNum,
                            audioNumber: ayahData.number,
                            options: options,
                            correctIndex: options.findIndex(o => o.name === surah.name)
                        });
                    }
                }

                return questions;
            },

            async generateAudioAyahQuestions() {
                const questions = [];
                const targetSurahs = this.shuffleArray([...SURAHS_JUZ30].filter(s => s.ayahs > 2)).slice(0, this.state.totalQuestions);

                for (const surah of targetSurahs) {
                    const maxAyah = surah.ayahs - 1;
                    const ayahNum = Math.floor(Math.random() * maxAyah) + 1;
                    
                    const currentAyah = await this.fetchAyah(surah.number, ayahNum);
                    const nextAyah = await this.fetchAyah(surah.number, ayahNum + 1);

                    if (currentAyah && nextAyah) {
                        // Get wrong options
                        const wrongOptions = [];
                        const otherSurahs = this.shuffleArray(SURAHS_JUZ30.filter(s => s.number !== surah.number)).slice(0, 3);
                        
                        for (const wrongSurah of otherSurahs) {
                            const wrongNum = Math.floor(Math.random() * wrongSurah.ayahs) + 1;
                            const wrongAyah = await this.fetchAyah(wrongSurah.number, wrongNum);
                            if (wrongAyah) wrongOptions.push(wrongAyah.text);
                        }

                        if (wrongOptions.length >= 3) {
                            const options = this.shuffleArray([nextAyah.text, ...wrongOptions.slice(0, 3)]);
                            questions.push({
                                type: 'audio_ayah',
                                surah: surah,
                                ayahNumber: ayahNum,
                                audioNumber: currentAyah.number,
                                correctAnswer: nextAyah.text,
                                options: options,
                                correctIndex: options.indexOf(nextAyah.text)
                            });
                        }
                    }
                }

                return questions;
            },

            // ============ START TESTS ============
            async startTextTest(source) {
                this.state.testMode = 'text';
                this.state.currentIndex = 0;
                this.state.score = 0;
                this.state.isAnswered = false;

                // Show loading
                this.navigate('quiz');
                document.getElementById('questionText').textContent = this.t('loading');
                document.getElementById('optionsContainer').innerHTML = '';
                document.getElementById('ayahDisplay').classList.remove('hidden');
                document.getElementById('audioPlayer').classList.add('hidden');
                document.getElementById('quizMode').textContent = this.t('modeText');

                // Generate questions
                this.state.questions = await this.generateTextQuestions(source);
                
                if (this.state.questions.length > 0) {
                    this.state.totalQuestions = this.state.questions.length;
                    this.showQuestion();
                } else {
                    alert('Savollar yuklanmadi. Qayta urinib ko\'ring.');
                    this.navigate('home');
                }
            },

            async startAudioTest(type) {
                this.state.testMode = type === 'surah' ? 'audio_surah' : 'audio_ayah';
                this.state.currentIndex = 0;
                this.state.score = 0;
                this.state.isAnswered = false;

                // Show loading
                this.navigate('quiz');
                document.getElementById('questionText').textContent = this.t('loading');
                document.getElementById('optionsContainer').innerHTML = '';
                document.getElementById('ayahDisplay').classList.add('hidden');
                document.getElementById('audioPlayer').classList.remove('hidden');
                document.getElementById('quizMode').textContent = type === 'surah' ? this.t('modeAudioSurah') : this.t('modeAudioAyah');

                // Generate questions
                if (type === 'surah') {
                    this.state.questions = await this.generateAudioSurahQuestions();
                } else {
                    this.state.questions = await this.generateAudioAyahQuestions();
                }

                if (this.state.questions.length > 0) {
                    this.state.totalQuestions = this.state.questions.length;
                    this.showQuestion();
                } else {
                    alert('Savollar yuklanmadi. Qayta urinib ko\'ring.');
                    this.navigate('home');
                }
            },

            // ============ QUIZ LOGIC ============
            showQuestion() {
                const q = this.state.questions[this.state.currentIndex];
                this.state.isAnswered = false;

                // Update progress
                const progress = ((this.state.currentIndex) / this.state.totalQuestions) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('quizCounter').textContent = `${this.state.currentIndex + 1} / ${this.state.totalQuestions}`;

                // Reset UI
                document.getElementById('hikmatBox').classList.remove('show');
                document.getElementById('btnNext').classList.remove('show');

                // Set question text
                if (q.type === 'text') {
                    document.getElementById('questionText').textContent = this.t('questionTextTest');
                    document.getElementById('ayahDisplay').textContent = q.ayahText;
                    document.getElementById('ayahDisplay').classList.remove('hidden');
                    document.getElementById('audioPlayer').classList.add('hidden');
                } else if (q.type === 'audio_surah') {
                    document.getElementById('questionText').textContent = this.t('questionAudioSurah');
                    document.getElementById('ayahDisplay').classList.add('hidden');
                    document.getElementById('audioPlayer').classList.remove('hidden');
                    this.prepareAudio(q.audioNumber);
                } else if (q.type === 'audio_ayah') {
                    document.getElementById('questionText').textContent = this.t('questionAudioAyah');
                    document.getElementById('ayahDisplay').classList.add('hidden');
                    document.getElementById('audioPlayer').classList.remove('hidden');
                    this.prepareAudio(q.audioNumber);
                }

                // Render options
                const container = document.getElementById('optionsContainer');
                container.innerHTML = '';
                
                const letters = ['A', 'B', 'C', 'D'];
                q.options.forEach((opt, index) => {
                    const optEl = document.createElement('div');
                    optEl.className = 'option-item';
                    
                    if (q.type === 'text' || q.type === 'audio_ayah') {
                        optEl.classList.add('ar-text');
                        optEl.innerHTML = `<span class="option-letter">${letters[index]}</span><span>${opt}</span>`;
                    } else {
                        // Audio surah - show surah name
                        const displayName = this.state.language === 'ar' ? opt.ar : opt.name;
                        optEl.innerHTML = `<span class="option-letter">${letters[index]}</span><span>${displayName}</span>`;
                    }
                    
                    optEl.onclick = () => this.selectAnswer(index);
                    container.appendChild(optEl);
                });
            },

            prepareAudio(globalAyahNum) {
                // Stop any playing audio
                if (this.state.currentAudio) {
                    this.state.currentAudio.pause();
                    this.state.currentAudio = null;
                }

                const playBtn = document.getElementById('playBtn');
                const audioStatus = document.getElementById('audioStatus');
                
                playBtn.disabled = false;
                playBtn.classList.remove('loading');
                document.getElementById('playIcon').textContent = 'â–¶ï¸';
                audioStatus.textContent = this.t('tapToPlay');

                // Preload audio
                const audioUrl = this.getAudioUrlByGlobal(globalAyahNum);
                this.state.currentAudio = new Audio(audioUrl);
                
                this.state.currentAudio.addEventListener('ended', () => {
                    document.getElementById('playIcon').textContent = 'â–¶ï¸';
                    audioStatus.textContent = this.t('tapToPlay');
                });
            },

            playAudio() {
                if (!this.state.currentAudio) return;

                const playBtn = document.getElementById('playBtn');
                const audioStatus = document.getElementById('audioStatus');

                if (this.state.currentAudio.paused) {
                    playBtn.classList.add('loading');
                    audioStatus.textContent = this.t('loading');
                    
                    this.state.currentAudio.play().then(() => {
                        playBtn.classList.remove('loading');
                        document.getElementById('playIcon').textContent = 'â¸ï¸';
                        audioStatus.textContent = '...';
                    }).catch(err => {
                        console.error('Audio error:', err);
                        playBtn.classList.remove('loading');
                        audioStatus.textContent = 'Xatolik';
                    });
                } else {
                    this.state.currentAudio.pause();
                    document.getElementById('playIcon').textContent = 'â–¶ï¸';
                    audioStatus.textContent = this.t('tapToPlay');
                }
            },

            selectAnswer(selectedIndex) {
                if (this.state.isAnswered) return;
                this.state.isAnswered = true;

                const q = this.state.questions[this.state.currentIndex];
                const options = document.querySelectorAll('.option-item');
                
                // Disable all options
                options.forEach(opt => opt.classList.add('disabled'));

                // Mark correct/wrong
                if (selectedIndex === q.correctIndex) {
                    options[selectedIndex].classList.add('correct');
                    this.state.score++;
                } else {
                    options[selectedIndex].classList.add('wrong');
                    options[q.correctIndex].classList.add('correct');
                }

                // Show hikmat
                const hikmatList = HIKMATLAR[this.state.language];
                const randomHikmat = hikmatList[Math.floor(Math.random() * hikmatList.length)];
                document.getElementById('hikmatText').textContent = randomHikmat;
                document.getElementById('hikmatBox').classList.add('show');

                // Show next button
                document.getElementById('btnNext').classList.add('show');
            },

            nextQuestion() {
                this.state.currentIndex++;
                
                if (this.state.currentIndex >= this.state.totalQuestions) {
                    this.showResult();
                } else {
                    this.showQuestion();
                }
            },

            showResult() {
                // Stop audio
                if (this.state.currentAudio) {
                    this.state.currentAudio.pause();
                    this.state.currentAudio = null;
                }

                const percent = Math.round((this.state.score / this.state.totalQuestions) * 100);
                
                // Update high score
                if (percent > this.state.highScore) {
                    this.state.highScore = percent;
                    localStorage.setItem('quraniq_highscore', percent);
                    document.getElementById('displayHighScore').textContent = percent + '%';
                }

                // Navigate to result page
                this.navigate('result');

                // Update result UI
                document.getElementById('resultPercent').textContent = percent + '%';
                document.getElementById('resultCorrect').textContent = this.state.score;
                document.getElementById('resultWrong').textContent = this.state.totalQuestions - this.state.score;

                // Result circle styling
                const circle = document.getElementById('resultCircle');
                circle.classList.remove('excellent', 'good', 'poor');
                
                let message = '';
                if (percent >= 90) {
                    circle.classList.add('excellent');
                    message = this.t('resultPerfect');
                } else if (percent >= 70) {
                    circle.classList.add('good');
                    message = this.t('resultGreat');
                } else if (percent >= 50) {
                    circle.classList.add('good');
                    message = this.t('resultGood');
                } else {
                    circle.classList.add('poor');
                    message = this.t('resultFail');
                }
                
                document.getElementById('resultMessage').textContent = message;
            },

            exitQuiz() {
                // Stop audio
                if (this.state.currentAudio) {
                    this.state.currentAudio.pause();
                    this.state.currentAudio = null;
                }
                this.navigate('home');
            },

            // ============ UTILITY ============
            shuffleArray(array) {
                const arr = [...array];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }
        };

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
